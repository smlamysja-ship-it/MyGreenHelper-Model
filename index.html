<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Green Helper ðŸŒ±</title>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #d8f3dc; /* light green */
      text-align: center;
    }
    #home, #scanner, #result {
      display: none;
      padding: 20px;
    }
    #home { display: block; }
    #logo { width: 150px; margin-top: 50px; }
    h1 { color: #2f5233; }
    button {
      padding: 10px 20px;
      font-size: 18px;
      margin-top: 20px;
      cursor: pointer;
      border: none;
      border-radius: 8px;
      background-color: #40916c;
      color: white;
    }
    #webcam-container { margin-top: 20px; }
    #disease-box {
      border: 2px solid #40916c;
      border-radius: 10px;
      padding: 15px;
      margin-top: 20px;
      display: inline-block;
      background-color: #f1faee;
      text-align: left;
      max-width: 400px;
    }
    #status { margin-top: 10px; font-style: italic; color: #555; }
  </style>
</head>
<body>

  <!-- HOME PAGE -->
  <div id="home">
    <img id="logo" src="ChatGPT Image Oct 22, 2025, 07_33_36 PM.png" alt="App Logo">
    <h1>My Green Helper ðŸŒ±</h1>
    <button onclick="goToScanner()">Start Scanning</button>
  </div>

  <!-- SCANNER PAGE -->
  <div id="scanner">
    <div id="webcam-container"></div>
    <button onclick="captureLeaf()">Capture Leaf</button>
    <div id="status">Loading...</div>
    <button onclick="goHome()">Back to Home</button>
  </div>

  <!-- RESULT PAGE -->
  <div id="result">
    <h2>Disease Detected:</h2>
    <div id="disease-box"></div>
    <button onclick="goHome()">Back to Home</button>
  </div>

<script>
let model, webcam, maxPredictions;

// Hugging Face links
const modelURL = "https://huggingface.co/spaces/Oposao/mygreenhelper-model/resolve/main/model.json";
const metadataURL = "https://huggingface.co/spaces/Oposao/mygreenhelper-model/resolve/main/metadata.json";

// Disease â†’ Treatment mapping
const diseaseTreatment = {
"Rice Plant with Blast Disease": "Remove infected leaves. Use fungicides like Tricyclazole.",
"Rice Plant with Sheath Blight": "Improve drainage. Apply fungicides like Carbendazim.",
"Rice Plant with Brown Spot": "Use resistant varieties and balance fertilization.",
"Rice Plant with false Smut": "Remove infected panicles and apply fungicide.",
"Rice Plant with Sheath Rot": "Improve air circulation and avoid water stress.",
"Rice Plant with Bacterial Leaf Blight (BLB)": "Use disease-free seeds and copper sprays.",
"Rice Plant with Bacterial Leaf Streak (BLS)": "Maintain proper spacing and apply bactericides.",
"Rice Plant with Bacterial Panicle Blight (BPB)": "Remove infected panicles and improve nutrition.",
"Rice Plant with Tungro Disease": "Control vector (green leafhopper) and remove infected plants.",
"Rice Plant with Grassy stunt Disease": "Use resistant varieties and manage vectors.",
"Wheat Plant with Stripe or Yellow Rust": "Apply fungicides like Propiconazole and remove infected plants.",
"Wheat Plant with Leaf or Brown Rust": "Use resistant varieties and proper crop rotation.",
"Wheat Plant with Stem or Black Rust": "Fungicide application and resistant varieties.",
"Wheat Plant with Loose Smut": "Use certified seeds and seed treatment.",
"Wheat Plant with Karnal Bunt": "Avoid infected seeds and rotate crops.",
"Wheat Plant with Powdery Mildew": "Apply sulfur or potassium bicarbonate sprays.",
"Wheat Plant with Alternaria Leaf Blight": "Remove infected leaves and apply fungicides.",
"Wheat Plant with Foot and Root Rot Complex": "Improve soil drainage and crop rotation.",
"Wheat Plant with Flag Smut": "Use resistant varieties and treat seeds.",
"Wheat Plant with Ear Cockle and Yellow Rot": "Remove infected plants and rotate crops.",
"Sugarcane Plant with Red Rot": "Use resistant varieties and remove infected canes.",
"Sugarcane Plant with Smut": "Burn infected setts and use resistant varieties.",
"Sugarcane Plant with Grassy Shoot Disease": "Plant disease-free setts and control insects.",
"Sugarcane Plant with Wilt": "Use resistant varieties and remove affected plants.",
"Sugarcane Plant with Pokkah Boeng": "Use fungicides and remove infected leaves.",
"Sugarcane Plant with Ratoon Stunting Disease (RSD)": "Plant disease-free setts and practice crop rotation.",
"Sugarcane Plant with Mosaic": "Use resistant varieties and remove infected canes.",
"Sugarcane Plant with Rust": "Apply fungicides and use resistant varieties.",
"Sugarcane Plant with Sett Rot (Pineapple Disease)": "Remove infected setts and treat with fungicides.",
"Sugarcane Plant with Red Stripe": "Remove infected leaves and improve nutrition.",
"Tulsi Plant with Downy Mildew": "Apply fungicides and maintain proper spacing.",
"Tulsi Plant with Fusarium wilt and crown rot": "Improve drainage and remove infected plants.",
"Tulsi Plant with Powdery mildew": "Apply sulfur sprays and remove infected leaves.",
"Tulsi Plant with Cercospora leaf spot": "Remove infected leaves and use fungicides.",
"Tulsi Plant with Basal rot and damping off": "Ensure proper soil drainage and avoid overwatering.",
"Tulsi Plant with Gray mold (Botrytis cinerea)": "Remove infected parts and apply fungicide.",
"Tulsi Plant with Bacterial leaf spot": "Apply copper-based sprays and remove infected leaves.",
"Tulsi Plant with Anthracnose Disease": "Remove infected leaves and improve air circulation.",
"Tulsi Plant with Root rot": "Improve drainage and avoid overwatering.",
"Tulsi Plant with Spider mites": "Use insecticidal soap or neem oil.",
"Aloe Vera Plant with Leaf Spot": "Remove infected leaves and apply fungicide.",
"Aloe Vera Plant with Root Rot": "Ensure proper drainage and avoid overwatering.",
"Aloe Vera Plant with Basal Stem Rot": "Remove infected parts and treat with fungicides.",
"Aloe Vera Plant with Anthracnose": "Remove infected leaves and apply fungicide.",
"Aloe Vera Plant with Bacterial Soft Rot": "Remove affected parts and maintain hygiene.",
"Aloe Vera Plant with Aloe Rust": "Remove affected areas and improve air circulation.",
"Aloe Vera Plant with Sooty Mold": "Clean leaves with water and control pests.",
"Aloe Vera Plant with Curvularia Lunata": "Remove infected parts and apply fungicide.",
"Aloe Vera Plant with Penicillium Purpurogenum": "Remove infected areas and maintain hygiene.",
"Aloe Vera Plant with Helminthosporium Spp": "Remove infected leaves and apply fungicide."
};

// Navigate pages
function goToScanner() {
  document.getElementById("home").style.display = "none";
  document.getElementById("scanner").style.display = "block";
  initModel();
}

function goHome() {
  document.getElementById("scanner").style.display = "none";
  document.getElementById("result").style.display = "none";
  document.getElementById("home").style.display = "block";
}

// Initialize model + webcam
async function initModel() {
  if (!model) {
    document.getElementById("status").innerText = "Loading model...";
    model = await tmImage.load(modelURL, metadataURL);
    maxPredictions = model.getTotalClasses();
    document.getElementById("status").innerText = "Model loaded!";
  }

  // Setup webcam
  const flip = true;
  webcam = new tmImage.Webcam(400, 400, flip);
  await webcam.setup();
  await webcam.play();
  document.getElementById("webcam-container").appendChild(webcam.canvas);
  window.requestAnimationFrame(loop);
}

// Continuous webcam update
function loop() {
  webcam.update();
  window.requestAnimationFrame(loop);
}

// Capture leaf and predict
async function captureLeaf() {
  document.getElementById("status").innerText = "Predicting...";
  const prediction = await model.predict(webcam.canvas);
  let topClass = prediction[0].className;
  let topProb = prediction[0].probability;
  for (let i = 1; i < prediction.length; i++) {
    if (prediction[i].probability > topProb) {
      topClass = prediction[i].className;
      topProb = prediction[i].probability;
    }
  }

  const treatment = diseaseTreatment[topClass] || "No treatment info available.";
  document.getElementById("scanner").style.display = "none";
  document.getElementById("result").style.display = "block";
  document.getElementById("disease-box").innerHTML =
    `<strong>${topClass}</strong><br><br>${treatment}`;
}
</script>
</body>
</html>
